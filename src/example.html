<!DOCTYPE html>

<html>

    <head>
        <title>Pathfinder Example</title>
        <script src="pathfinder.min.js"></script>
    </head>

    <body>

        <canvas id="grid"></canvas>

        <script>

            /*
             * Walled grid
             */
            if (window.location.hash.substr(1) == '2')
            {

                var width   = 100;
                var height  = 50;
                var blocked = ["50,3","50,4","50,5","50,6","50,7","50,8","50,9","50,10","50,11","50,12","50,13","50,14","50,15","50,16","50,18","50,19","50,20","50,21","50,22","50,23","50,24","50,25","50,26","50,27","50,28","50,29","50,30","50,31","50,32","50,33","50,34","50,35","50,36","50,39","50,40","50,41","50,42","50,43","50,44","50,45","50,46","3,23","4,23","5,23","6,23","7,23","8,23","9,23","10,23","11,23","12,23","13,23","14,23","15,23","16,23","17,23","18,23","19,23","20,23","21,23","22,23","23,23","24,23","25,23","26,23","27,23","28,23","29,23","30,23","31,23","32,23","33,23","34,23","35,23","36,23","37,23","38,23","39,23","40,23","41,23","42,23","43,23","44,23","45,23","46,23","47,23","48,23","49,23","50,23","51,23","52,23","53,23","54,23","55,23","56,23","57,23","58,23","59,23","60,23","61,23","62,23","63,23","64,23","66,23","67,23","68,23","69,23","70,23","71,23","72,23","73,23","74,23","75,23","76,23","77,23","78,23","79,23","80,23","81,23","82,23","83,23","84,23","85,23","86,23","87,23","88,23","89,23","90,23","91,23","92,23","93,23","94,23","95,23"];

            }

            /*
             * Random grid
             */
            else
            {

                var width     = Math.ceil(Math.random() * 175);
                var height    = Math.ceil(Math.random() * 100);
                var obstacles = Math.ceil(Math.random() * ((width * height) / 1.5));
                var blocked   = [];

                /*
                * Populate the grid with random obstacles
                */
                for (var i = 0; i < obstacles; i++)
                {
                    
                    var x = Math.ceil(Math.random() * width);
                    var y = Math.ceil(Math.random() * height);
                    
                    blocked.push(x + ',' + y);

                }
                
            }

            /*
             * Set up the pathfinder with the information defined above
             */
            var pathfinder = new Pathfinder(width, height, blocked);
            var startX     = Math.ceil(Math.random() * width);
            var startY     = Math.ceil(Math.random() * height);
            var endX       = Math.ceil(Math.random() * width);
            var endY       = Math.ceil(Math.random() * height);
            var start      = pathfinder.getBlockAtCoordinate(startX, startY);
            var end        = pathfinder.getBlockAtCoordinate(endX, endY);
            
            /*
             * Make sure that the start and end points aren't blocked
             */
            start.isBlocked = false;
            end.isBlocked   = false;

            /*
             * Set up the HTML canvas for drawing
             */
            var canvas  = document.getElementById('grid');
            var context = canvas.getContext('2d');

            canvas.style.width    = (width * 10) + 'px';
            canvas.style.height   = (height * 10) + 'px';
            context.canvas.width  = (width * 10);
            context.canvas.height = (height * 10);

            try
            {

                /*
                 * Find the path
                 */
                var path = pathfinder.getNavigationPath(start, end, {allowDiagonals: true});

                /*
                 * Draw obstacles
                 */
                for (var x in pathfinder.grid.blocks)
                {

                    for (var y in pathfinder.grid.blocks[x])
                    {

                        if (pathfinder.grid.blocks[x][y].isBlocked)
                        {
                            context.fillStyle = '#999';
                            context.beginPath();
                            context.arc((((x - 1) * 10) + 5), (((y - 1) * 10) + 5), 3, 0, (Math.PI + (Math.PI * 2) / 2));
                            context.fill();
                        }

                    }

                }

                /*
                 * Draw start and end points
                 */
                context.fillStyle = '#f00';
                context.beginPath();
                context.arc((((start.x - 1) * 10) + 5), (((start.y - 1) * 10) + 5), 5, 0, (Math.PI + (Math.PI * 2) / 2));
                context.fill();
                context.beginPath();
                context.arc((((end.x - 1) * 10) + 5), (((end.y - 1) * 10) + 5), 5, 0, (Math.PI + (Math.PI * 2) / 2));
                context.fill();

                /*
                 * Draw an incremental reconstruction of the path as it was
                 * explored
                 */
                var pathfindingPosition = 0;
                var pathfindingInterval = setInterval(function()
                {

                    var exploredBlock = path.explored[pathfindingPosition++];

                    context.fillStyle = '#d9d9d9';
                    context.fillRect(((exploredBlock.x - 1) * 10), ((exploredBlock.y - 1) * 10), 10, 10);

                    if (pathfindingPosition >= (path.explored.length - 1))
                    {

                        clearInterval(pathfindingInterval);

                        /*
                         * Draw an incremental reconstruction of the best path
                         */
                        var pathPosition = 1;
                        var pathInterval = setInterval(function()
                        {

                            var pathBlock = path.path[pathPosition];

                            context.fillStyle = '#aaa';
                            context.fillRect(((pathBlock.x - 1) * 10), ((pathBlock.y - 1) * 10), 10, 10);

                            pathPosition++;

                            /*
                             * When the path has all been drawn, tidy up and
                             * reload the page
                             */
                            if (pathPosition >= (path.path.length - 1))
                            {

                                clearInterval(pathInterval);

                                setTimeout(function()
                                {
                                    location.reload();
                                }, 500);

                            }

                        }, 10);

                    }

                }, 10);

            }

            /*
             * If there was an error (such as no path being found), reload the
             * page to try another grid
             */
            catch (exception)
            {
                location.reload();
            }

        </script>

    </body>

</html>