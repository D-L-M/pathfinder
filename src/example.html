<!DOCTYPE html>

<html>

    <head>
        <title>Pathfinder Example</title>
        <script src="pathfinder.min.js"></script>
    </head>

    <body>

        <canvas id="grid"></canvas>

        <script>

            /*
             * Define a random grid
             */
            var width     = Math.ceil(Math.random() * 175);
            var height    = Math.ceil(Math.random() * 100);
            var obstacles = Math.ceil(Math.random() * ((width * height) / 1.5));
            var blocked   = [];

            /*
             * Populate the grid with random obstacles
             */
            for (var i = 0; i < obstacles; i++)
            {
                
                var x = Math.ceil(Math.random() * width);
                var y = Math.ceil(Math.random() * height);
                
                blocked.push(x + ',' + y);

            }

            /*
             * Set up the pathfinder with the information defined above
             */
            var pathfinder = new Pathfinder(width, height, blocked);
            var startX     = Math.ceil(Math.random() * width);
            var startY     = Math.ceil(Math.random() * height);
            var endX       = Math.ceil(Math.random() * width);
            var endY       = Math.ceil(Math.random() * height);
            var start      = pathfinder.getBlockAtCoordinate(startX, startY);
            var end        = pathfinder.getBlockAtCoordinate(endX, endY);

            /*
             * Set up the HTML canvas for drawing
             */
            var canvas  = document.getElementById('grid');
            var context = canvas.getContext('2d');

            canvas.style.width    = (width * 10) + 'px';
            canvas.style.height   = (height * 10) + 'px';
            context.canvas.width  = (width * 10);
            context.canvas.height = (height * 10);

            try
            {

                /*
                 * Find the path
                 */
                var path = pathfinder.getNavigationPath(start, end, {allowDiagonals: true});

                /*
                 * Draw obstacles
                 */
                for (var x in pathfinder.grid.blocks)
                {

                    for (var y in pathfinder.grid.blocks[x])
                    {

                        if (pathfinder.grid.blocks[x][y].isBlocked)
                        {
                            context.fillStyle = '#999';
                            context.beginPath();
                            context.arc((((x - 1) * 10) + 5), (((y - 1) * 10) + 5), 3, 0, (Math.PI + (Math.PI * 2) / 2));
                            context.fill();
                        }

                    }

                }

                /*
                 * Draw start and end points
                 */
                context.fillStyle = '#f00';
                context.beginPath();
                context.arc((((start.x - 1) * 10) + 5), (((start.y - 1) * 10) + 5), 5, 0, (Math.PI + (Math.PI * 2) / 2));
                context.fill();
                context.beginPath();
                context.arc((((end.x - 1) * 10) + 5), (((end.y - 1) * 10) + 5), 5, 0, (Math.PI + (Math.PI * 2) / 2));
                context.fill();

                /*
                 * Draw an incremental reconstruction of the path as it was
                 * explored
                 */
                var pathfindingPosition = 0;
                var pathfindingInterval = setInterval(function()
                {

                    var exploredBlock = path.explored[pathfindingPosition++];

                    context.fillStyle = '#d9d9d9';
                    context.fillRect(((exploredBlock.x - 1) * 10), ((exploredBlock.y - 1) * 10), 10, 10);

                    if (pathfindingPosition >= (path.explored.length - 1))
                    {

                        clearInterval(pathfindingInterval);

                        /*
                         * Draw an incremental reconstruction of the best path
                         */
                        var pathPosition = (path.path.length - 2);
                        var pathInterval = setInterval(function()
                        {

                            var pathBlock = path.path[pathPosition];

                            context.fillStyle = '#aaa';
                            context.fillRect(((pathBlock.x - 1) * 10), ((pathBlock.y - 1) * 10), 10, 10);

                            pathPosition--;

                            /*
                             * When the path has all been drawn, tidy up and
                             * reload the page
                             */
                            if (pathPosition <= 0)
                            {

                                clearInterval(pathInterval);

                                setTimeout(function()
                                {
                                    location.reload();
                                }, 500);

                            }

                        }, 10);

                    }

                }, 10);

            }

            /*
             * If there was an error (such as no path being found), reload the
             * page to try another grid
             */
            catch (exception)
            {
                location.reload();
            }

        </script>

    </body>

</html>